<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>注册</title>
</head>
<body>
  <h2>用户注册</h2>
  <form id="registerForm">
    <div>
      <label>用户名：</label>
      <input type="text" id="username" />
      <span id="error-username" style="color:red"></span>
    </div>
    <div>
      <label>密码：</label>
      <input type="password" id="password" />
      <span id="error-password" style="color:red"></span>
    </div>
    <div>
      <label>邮箱：</label>
      <input type="email" id="email" />
      <span id="error-email" style="color:red"></span>
    </div>
    <button type="submit">注册</button>
  </form>

  <script>
    const form = document.getElementById('registerForm');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // 清空错误提示
      document.getElementById('error-username').textContent = '';
      document.getElementById('error-password').textContent = '';
      document.getElementById('error-email').textContent = '';

      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      const email = document.getElementById('email').value.trim();

      let valid = true;

      // 简单校验
      if (!username) {
        document.getElementById('error-username').textContent = '用户名不能为空';
        valid = false;
      }
      if (!password || password.length < 6) {
        document.getElementById('error-password').textContent = '密码至少6位';
        valid = false;
      }
      // 简单邮箱格式验证
      const emailRegex = /^\S+@\S+\.\S+$/;
      if (!email || !emailRegex.test(email)) {
        document.getElementById('error-email').textContent = '邮箱格式错误';
        valid = false;
      }

      if (!valid) return;

      // 发送请求
      try {
        const res = await fetch('http://localhost:8080/api/v1/users/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password, email }),
        });
        const data = await res.json();
        if (!res.ok) {
          alert('后端错误: ' + (data.error || JSON.stringify(data)));
        } else {
          alert('注册成功');
          form.reset();
        }
      } catch (err) {
        alert('网络错误');
      }
    });
  </script>
</body>
</html>
